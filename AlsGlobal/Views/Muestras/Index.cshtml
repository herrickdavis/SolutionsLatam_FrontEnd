@model ResponseServiceViewModel<List<string>, List<string>, List<string>>
@inject IStringLocalizer<SharedResources> SharedLocalizer
@{
  MuestraViewModel muestraDetalle = ViewBag.Detalle;
  ResponseServiceViewModel<List<string>, List<string>, List<string>> certificados = (ResponseServiceViewModel<List<string>, List<string>, List<string>>)ViewBag.Informe;
    var columnasFilter = (IEnumerable<ColumnasResponseViewModel>)ViewBag.ColumnasFilter;
}
<!--begin::Table Widget 6-->
<div class="vistaLista" style="display:block">
    <div class="card card-custom gutter-b">
        <div class="card-header flex-wrap border-0 pt-6 pb-0">
            <div class="card-title">
                <h3 class="card-label">
                    @SharedLocalizer["Muestras.TituloMuestras"]
                </h3>
            </div>
            <div class="card-toolbar">
                <div class="dropdown dropdown-inline dropdown-btn-columnas">
                    <a href="javascript:void(0)" class="btn btn-icon-primary btn-clean btn-hover-light-primary btn-sm btn-icon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-cog"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-md dropdown-menu-right dropdown-columnas" style="">
                    <!--begin::Navigation-->
                        <ul class="navi navi-hover py-5">
                            @foreach(var columnas in columnasFilter){
                                <li class="navi-item p-3">
                                    <label class="checkbox">
                                        <input type="checkbox" name="Checkboxes1" data-header="@columnas.columna" @(columnas.estado ? "checked" : "")/>
                                        <span></span>&nbsp;
                                        @columnas.columna
                                    </label>
                                </li>
                            }
                        </ul>
                    <!--end::Navigation-->
                    </div>
                </div>
                <button type="button" class="btn btn-info btnReporteMuestra mr-1">
                    <i class="flaticon-download"></i> @SharedLocalizer["Muestras.Reporte"]
                </button>
                <button type="button" class="btn btn-info btnDescargarMuestra" data-toggle="modal" data-target="#modalDescarga" style="display:none;">
                    <i class="flaticon-download"></i> @SharedLocalizer["Muestras.Documentos"]
                </button>
                <button type="button" class="btn btn-info btnDescargarCertificado" style="display:none;">
                    <i class="flaticon-download"></i> @SharedLocalizer["Muestras.Documentos"]
                </button>
                <div class="dropdown dropdown-inline">
                    <a href="#" class="btn btn-icon-primary btn-clean btn-hover-light-primary btn-sm btn-icon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="svg-icon svg-icon-primary svg-icon-2x">
                            <!--begin::Svg Icon | path:C:\wamp64\www\keenthemes\themes\keen\theme\demo1\dist/../src/media/svg/icons\General\Other1.svg--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                    <rect x="0" y="0" width="24" height="24" />
                                    <circle fill="#000000" cx="12" cy="5" r="2" />
                                    <circle fill="#000000" cx="12" cy="12" r="2" />
                                    <circle fill="#000000" cx="12" cy="19" r="2" />
                                </g>
                            </svg><!--end::Svg Icon-->
                        </span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-md dropdown-menu-right" style="">
                        <!--begin::Navigation-->
                        <ul class="navi navi-hover py-5">
                            <li class="navi-item">
                                <a href="javascript:void(0)" class="navi-link opcionMuestra">
                                    <span class="navi-icon">
                                        <span class="svg-icon svg-icon-md svg-icon-primary">
                                            <!--begin::Svg Icon | path:assets/media/svg/icons/Communication/Add-user.svg-->
                                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                    <polygon points="0 0 24 0 24 24 0 24"></polygon>
                                                    <path d="M12.9336061,16.072447 L19.36,10.9564761 L19.5181585,10.8312381 C20.1676248,10.3169571 20.2772143,9.3735535 19.7629333,8.72408713 C19.6917232,8.63415859 19.6104327,8.55269514 19.5206557,8.48129411 L12.9336854,3.24257445 C12.3871201,2.80788259 11.6128799,2.80788259 11.0663146,3.24257445 L4.47482784,8.48488609 C3.82645598,9.00054628 3.71887192,9.94418071 4.23453211,10.5925526 C4.30500305,10.6811601 4.38527899,10.7615046 4.47382636,10.8320511 L4.63,10.9564761 L11.0659024,16.0730648 C11.6126744,16.5077525 12.3871218,16.5074963 12.9336061,16.072447 Z" fill="#000000" fill-rule="nonzero"></path>
                                                    <path d="M11.0563554,18.6706981 L5.33593024,14.122919 C4.94553994,13.8125559 4.37746707,13.8774308 4.06710397,14.2678211 C4.06471678,14.2708238 4.06234874,14.2738418 4.06,14.2768747 L4.06,14.2768747 C3.75257288,14.6738539 3.82516916,15.244888 4.22214834,15.5523151 C4.22358765,15.5534297 4.2250303,15.55454 4.22647627,15.555646 L11.0872776,20.8031356 C11.6250734,21.2144692 12.371757,21.2145375 12.909628,20.8033023 L19.7677785,15.559828 C20.1693192,15.2528257 20.2459576,14.6784381 19.9389553,14.2768974 C19.9376429,14.2751809 19.9363245,14.2734691 19.935,14.2717619 L19.935,14.2717619 C19.6266937,13.8743807 19.0546209,13.8021712 18.6572397,14.1104775 C18.654352,14.112718 18.6514778,14.1149757 18.6486172,14.1172508 L12.9235044,18.6705218 C12.377022,19.1051477 11.6029199,19.1052208 11.0563554,18.6706981 Z" fill="#000000" opacity="0.3"></path>
                                                </g>
                                            </svg>
                                            <!--end::Svg Icon-->
                                        </span>
                                    </span>
                                    <span class="navi-text">Muestra</span>
                                </a>
                            </li>
                            <li class="navi-item">
                                <a href="javascript:void(0)" class="navi-link opcionCertificado">
                                    <span class="navi-icon">
                                        <span class="svg-icon svg-icon-md svg-icon-primary">
                                            <!--begin::Svg Icon | path:assets/media/svg/icons/Communication/Clipboard-check.svg-->
                                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                    <rect x="0" y="0" width="24" height="24"></rect>
                                                    <path d="M8,3 L8,3.5 C8,4.32842712 8.67157288,5 9.5,5 L14.5,5 C15.3284271,5 16,4.32842712 16,3.5 L16,3 L18,3 C19.1045695,3 20,3.8954305 20,5 L20,21 C20,22.1045695 19.1045695,23 18,23 L6,23 C4.8954305,23 4,22.1045695 4,21 L4,5 C4,3.8954305 4.8954305,3 6,3 L8,3 Z" fill="#000000" opacity="0.3"></path>
                                                    <path d="M10.875,15.75 C10.6354167,15.75 10.3958333,15.6541667 10.2041667,15.4625 L8.2875,13.5458333 C7.90416667,13.1625 7.90416667,12.5875 8.2875,12.2041667 C8.67083333,11.8208333 9.29375,11.8208333 9.62916667,12.2041667 L10.875,13.45 L14.0375,10.2875 C14.4208333,9.90416667 14.9958333,9.90416667 15.3791667,10.2875 C15.7625,10.6708333 15.7625,11.2458333 15.3791667,11.6291667 L11.5458333,15.4625 C11.3541667,15.6541667 11.1145833,15.75 10.875,15.75 Z" fill="#000000"></path>
                                                    <path d="M11,2 C11,1.44771525 11.4477153,1 12,1 C12.5522847,1 13,1.44771525 13,2 L14.5,2 C14.7761424,2 15,2.22385763 15,2.5 L15,3.5 C15,3.77614237 14.7761424,4 14.5,4 L9.5,4 C9.22385763,4 9,3.77614237 9,3.5 L9,2.5 C9,2.22385763 9.22385763,2 9.5,2 L11,2 Z" fill="#000000"></path>
                                                </g>
                                            </svg>
                                            <!--end::Svg Icon-->
                                        </span>
                                    </span>
                                    <span class="navi-text">Certificados</span>
                                </a>
                            </li>
                        </ul>
                        <!--end::Navigation-->
                    </div>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div id="divMuestras">
                @await Html.PartialAsync("_Muestras", Model)
            </div>
            <div id="divCertificados" style="display:none">
                @await Html.PartialAsync("_Certificados", certificados)
            </div>
        </div>
    </div>
</div>
<div class="vistaDetalle" style="display:none">
    <div class="d-flex justify-content-end mb-3">
        <button id="btnRetroceder" class="btn btn-info">
            <span class="flaticon2-back"></span> @SharedLocalizer["Muestras.Retroceder"]
        </button>
    </div>
    <div id="detalleMuestras">
        @await Html.PartialAsync("_Detalle", muestraDetalle)
    </div>
</div>
<!--end::Table Widget 6-->
<!--begin::Demo Panel-->
<div id="kt_demo_panel" class="offcanvas offcanvas-right p-10">
    <!--begin::Header-->
    <div class="offcanvas-header d-flex align-items-center justify-content-between pb-7">
        <h4 class="font-weight-bold m-0"> @SharedLocalizer["Muestras.Documentos"]</h4>
        <a href="#" class="btn btn-xs btn-icon btn-light btn-hover-primary" id="kt_aside_close_btn">
            <i class="ki ki-close icon-xs text-muted"></i>
        </a>
    </div>
    <!--end::Header-->
    <!--begin::Content-->
    <div class="offcanvas-content">
        <!--begin::Wrapper-->
        <div class="offcanvas-wrapper mb-5 scroll-pull" id="panelBody">

        </div>
        <!--end::Wrapper-->
    </div>
    <!--end::Content-->
</div>
<!--end::Demo Panel-->
<div class="modal fade" id="modalDescarga" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">@SharedLocalizer["Muestras.Descargar"]</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group row">
                    <label class="col-4 col-form-label">@SharedLocalizer["Muestras.TipoDeArchivo"]:</label>
                    <div class="col-8 col-form-label">
                        <div class="checkbox-list">
                            <label class="checkbox">
                                <input type="checkbox" data-tipoarchivo="2" name="chkTipoArchivo" />
                                <span></span>
                                @SharedLocalizer["Muestras.Informes"]
                            </label>
                            <label class="checkbox">
                                <input type="checkbox" data-tipoarchivo="102" name="chkTipoArchivo" />
                                <span></span>
                                @SharedLocalizer["Muestras.CadenaDeCustodia"]
                            </label>
                            <label class="checkbox">
                                <input type="checkbox" data-tipoarchivo="0" checked name="chkTipoArchivo" />
                                <span></span>
                                @SharedLocalizer["Muestras.Todos"]
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light-primary font-weight-bold" data-dismiss="modal">@SharedLocalizer["Muestras.Cerrar"]</button>
                <button type="button" class="btn btn-primary font-weight-bold descargar">@SharedLocalizer["Muestras.Descargar"]</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modalReporte" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">@SharedLocalizer["Muestras.Descargar"]</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="col-form-label">@SharedLocalizer["Muestras.Plantilla"]:</label>
                    <div class="col-form-label">
                        <select class="form-control" id="selectIdPlantilla">
                        </select>
                        <small id="emailHelp" class="form-text text-muted mt-2 ml-2"><a href="#" class="editLink">EDITAR</a> <a href="@Url.Action("index", "Edd")" class="ml-3">CREAR</a></small>
                        <div class="row mt-5">
                            <div class="col-6">
                                <input class="form-control" type="text" id="numero_grupo" />
                                <small id="emailHelp" class="form-text text-muted mt-2 ml-2">Numero Grupo (opcional)</small>
                            </div>
                            <div class="col-6">
                                <input class="form-control" type="text" id="year_grupo"/>
                                <small id="emailHelp" class="form-text text-muted mt-2 ml-2">Año Grupo (Opcional)</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light-primary font-weight-bold" data-dismiss="modal">@SharedLocalizer["Muestras.Cerrar"]</button>
                <button type="button" id="descargar_reporte" class="btn btn-primary font-weight-bold">@SharedLocalizer["Muestras.Descargar"]</button>
                <button class="btn btn-primary" type="button" id="descargando_activo" disabled style="display: none;">
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                    Descargando...
                </button>
            </div>
        </div>
    </div>
</div>
@section scripts{
    <script>
        var urlMuestras = "@Url.Action("ObtenerMuestras", "Muestras")";
        var urlCertificados = "@Url.Action("ObtenerCertificados", "Muestras")";
        var urlDetalle = "@Url.Action("Detalle", "Muestras")";
        var urlGetDocumentoEdd = "@Url.Action("GetDocumento", "Edd")";
        var urlGetDocumentosMuestra = "@Url.Action("GetDocumentosMuestra", "Muestras")";
        var urlGetDocumentoMuestra = "@Url.Action("GetDocumentoMuestra", "Muestras")";
        var urlObtenerParametros = "@Url.Action("ObtenerParametros", "Muestras")";
        var urlGetZipMuestra = "@Url.Action("GetZipMuestra", "Muestras")";
        var urlGetDocumentoInformes = "@Url.Action("GetDocumentoInformes", "Muestras")";
        var urlSetColumnasUsuario = "@Url.Action("SetColumnasUsuario", "Perfil")";
        var urlObtenerEdd = "@Url.Action("ObtenerEdd", "Muestras")";
        $(document).ready(function () {
            $("#selectIdPlantilla").change(function () {
                var selectedId = $(this).val(); // Obtener el valor seleccionado
                $("#editLink").data('id', selectedId); // Actualizar el data-id del enlace
            });

            $(".editLink").click(function (event) {
                var id = $('#selectIdPlantilla').val();
                if(id.indexOf("E") > -1) {
                    toastr.error("Plantilla Externa")
                    return false
                }
                var url = "@Url.Action("Index", "Edd")" + "?id=" + id;  // Construir la URL
                console.log(url)
                window.location.href = url;  // Navegar a esa URL
            });
        })
    </script>
        

    <script src="/js/muestras/muestras.js" asp-append-version="true"></script>
    <script src="/js/muestras/detalleMuestras.js" asp-append-version="true"></script>
}
